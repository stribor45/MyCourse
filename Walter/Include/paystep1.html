<?php

$errors = array();

$overtime_hours = "";  /*Overtime hours. */
$overtime = "";        /* Overtime hours pay. */
$reg_hours = "";       /* Number of regular hours. */
$regular = "";         /* Regular hours pay. */
$gross = "";           /* Gross pay. */
$payroll_tax = "";     /* Payroll taxes. */
$net_pay = "";         /* Net pay. */ 


if(isset ($_POST['my_submit'])) {
       

        $f = new NumberFormatter("en", NumberFormatter::CURRENCY);

        $overtime_hours = 0;
        $payroll_tax = 0;
        $first_name = $_POST['first_name'];
        $last_name = $_POST['last_name'];
        $hours =  $_POST['num_hours'];
        $wage = $_POST['wage'];

        $overtime_hours = "";  /*Overtime hours. */
        $overtime = "";        /* Overtime hours pay. */
        $reg_hours = "";       /* Number of regular hours. */
        $regular = "";         /* Regular hours pay. */
        $gross = "";           /* Gross pay. */
        $payroll_tax = "";     /* Payroll taxes. */
        $net_pay = "";         /* Net pay. */ 
    

        $first_name = trim($first_name);
        $last_name = trim($last_name);
        $hours = trim($hours);
        $wage = trim($wage);



        If ($hours > 40) {
            $reg_hours = 40;
            $overtime_hours = $hours - 40;
        }
        else {
            $reg_hours = $hours;
            $overtime_hours = 0;
        }


        if(empty($first_name)) {
            $errors['firstNameEmpty'] = "*";
        }
        if(empty($last_name)) {
            $errors['lastNameEmpty'] = "*";
        }
        if(empty($hours)) {
            $errors['hoursEmpty'] = "*";
        }
        if(empty($wage)) {
            $errors['wageEmpty'] = "*";
        }        
        
        check_first_name($first_name, 'firstNamelength');
        check_last_name($last_name, 'lastNamelength');
        check_num_hours_worked($hours,'numberOfHours');
        check_wage($wage,'wageEarned');

        if (count($errors) == 0) {
            $regular = calcuate_regular_pay ($reg_hours, $wage); //$reg_hours * $wage;
            $overtime = Calculate_OverTime_Pay ($overtime_hours, $wage); 
            $gross = $regular + $overtime;
            $payroll_tax = Calculate_Taxes ($gross, 0.25);    //$gross * 0.25;
            $net_pay = $gross - $payroll_tax;
            $regular = display_currency($regular);
            $overtime = display_currency($overtime);
            $gross = display_currency($gross);
            $payroll_tax = display_currency($payroll_tax);
            $net_pay = display_currency($net_pay);
            $wage = display_currency ($wage);
            $hours = number_format($hours, 2, '.', '');
            $overtime_hours = number_format($overtime_hours, 2, '.', '');
            $reg_hours = number_format($reg_hours, 2, '.', ''); 
        }
       
}
else {

    $first_name = "";      /* Data from input field. (First name) */
    $last_name = "";       /* Data from input field. (Last name)*/
    $hours = "";           /* Data from input field.  (Total hours worked)*/
    $wage = "";            /* Data from input field.  (Hourly wage) */

}

    /* This function will validate first name input. It will allow submission only 
       if input is NOT numberic and it is NOT smaller than two characters. */
    function check_first_name ($name, $index) {

        global $errors;

        if(!empty($name)) {
            if(is_numeric($name)) {
            
                $errors['firstisNumeric'] = "Must be letters"; 
            }
            else {
                if(strlen($name) < 2) {
                    $errors[$index] = "Must be at least 2 characters";
                }
            }   
        }

    } //check_first_name

    /* This function will validate last name input. It will allow submission only 
       if input is NOT numberic and it is NOT smaller than two characters and NOT bigger than 25 characters. */
    function check_last_name ($name, $index) {

        global $errors;
        if(!empty($name)) {
            if(is_numeric($name)) {
                echo "i am inside last name";
                $errors['lastisNumeric'] = "Must be letters"; 
            }
            else {
                if(strlen($name) < 2 | strlen($name) > 25) {
                    $errors[$index] = "Must be at least 2 characters and not more than 25 characters.";
                }
            }   
        }
        
    } //check_last_name

    /* This function will validate number of hours worked input. It will allow submission only 
       if input is numberic and it is NOT bigger than 60. */
    function check_num_hours_worked ($hours, $index) {

        global $errors;
        if(!empty($hours)) {
            if(!is_numeric($hours)) {
                $errors['hoursisNumeric'] = "Must be numbers"; 
            }
            else {
                $hours = intval($hours);
                if( $hours > 60) {
                    $errors[$index] = "Must be less or equal to 60 .";
                }
            }    
        }
        
    } //check_num_hours_worked

    /* This function will validate number for wage input. It will allow submission only 
       if input is numberic and it is bigger than 10. */
    function check_wage ($wage, $index) {

        global $errors;
        if(!empty($wage)) {
            if(!is_numeric($wage)) {
                $errors['wageisNumeric'] = "Must be numbers"; 
            }
            else {
                $wage = intval($wage);
                if( $wage <= 10) {
                    $errors[$index] = "Must be bigger than 10 .";
                }
            }    
        }
        
    } //check_wage   
    
    /* This function will calculate regular pay. */
    function calcuate_regular_pay ($number_of_hours, $my_wage) {

        $pay = $number_of_hours * $my_wage;
        return $pay;

    } //calculate_regular_pay
    
    /* This function will calculate overtime pay. */
    function calculate_overtime_pay ($number_of_hours, $my_wage) {

        $overtime_pay = $number_of_hours * ($my_wage * 1.5);
        return $overtime_pay; 

    } //calculate_overtime_pay
    
    /* This function will calculate taxes. */
    function calculate_taxes ($pay, $tax_bracket) {
            
        $tax = $pay * $tax_bracket;
        return $tax;
    
    } //calcuate_taxes

    /* This function will convert variable to display as currency. */
    function display_currency ($number){

        global $f;
        $number = number_format($number, 2, '.', '');
     
        return $f->formatCurrency($number, "USD");
    
    } //display_currency

?>


<div class="bodyContent">
    <!-- This is the form that will present the user with following input field
        First Name
        Last Name
        Number of hours worked
        Hourly Wage
        Gross earned
        Payroll Tax
        Net Pay
        asdded this to see if Linux will take this update
        I have to add validation for
        All Inputs (first name, last name, hourly wage and hours workd) must be entered.
        First Name can not have a length less than 2 characters
        Last Name cannot have a length less than 2 characters and cannot be more than 25
        Hourly wage must be greater than 10.00 and can only be numeric
        Hours worked can not exceed more than 60 hours for any given work period and must be numeric
        Added this to see if Windows will take the update
        added to see if Linux can see this update
        Added to see If Windows will see this update.
       
    -->


    <form action="" method="POST" autocomplete="off">  
   
        <div class="row">
           <div class="col">
               <label for="first_name">First Name</label> 
               <input type="text" id="first_name" name="first_name"  value = "<?php echo $first_name?>"/> 
           </div>
           <div class="error">
            <?php if(isset($errors['firstNameEmpty'])) echo $errors['firstNameEmpty'];?>					
            <?php if(isset($errors['firstNamelength'])) echo $errors['firstNamelength'];?>
            <?php if(isset($errors['firstisNumeric'])) echo $errors['firstisNumeric'];?>
            
        </div>
        </div>
        <div class="row">
        <div class="col">
            <label for="last_name">Last Name</label> 
            <input type="text" id="last_name" name="last_name" value = "<?php echo $last_name?>"/> 
        </div>
        <div class="error">
            <?php if(isset($errors['lastNameEmpty'])) echo $errors['lastNameEmpty'];?>					
            <?php if(isset($errors['lastNamelength'])) echo $errors['lastNamelength'];?>
            <?php if(isset($errors['lastisNumeric'])) echo $errors['lastisNumeric'];?>
            
        </div>
        </div>
        <div class="row">
           <div class="col">
               <label for="num_hours">Number of hours</label> 
               <input type="text" id="num_hours" name="num_hours" value = "<?php echo $hours?>"/> 
           </div>
           <div class="error">
            <?php if(isset($errors['hoursEmpty'])) echo $errors['hoursEmpty'];?>					
            <?php if(isset($errors['numberOfHours'])) echo $errors['numberOfHours'];?>
            <?php if(isset($errors['hoursisNumeric'])) echo $errors['hoursisNumeric'];?>
        </div>  
        </div>
    
        <div class="row">
           <div class="col">
               <label for="wage">Hourly Wage</label> 
               <input type="text" id="wage"  name="wage" value = "<?php echo $wage?>"/> 
           </div>
           <div class="error">
            <?php if(isset($errors['wageEmpty'])) echo $errors['wageEmpty'];?>					
            <?php if(isset($errors['wageEarned'])) echo $errors['wageEarned'];?>
            <?php if(isset($errors['wageisNumeric'])) echo $errors['wageisNumeric'];?>
        </div> 
        </div>
        <div class="row">
            <div class="col">
                <label for="wage">Overtime Hours</label> 
                <input type="text" id="over_hours"  name="over_hours" value = "<?php if(isset($overtime_hours) && count($errors) == 0 ) { echo $overtime_hours;} ?>" /> 
            </div>
        </div> 
        <div class="row">
            <div class="col">
                <label for="wage">Overtime Hours Pay</label> 
                <input type="text" id="over_pay"  name="over_pay" value = "<?php if(isset($overtime) && count($errors) == 0 ) { echo $overtime;} ?>" /> 
            </div>
        </div>  
        <div class="row">
            <div class="col">
                <label for="wage">Regular Hours</label> 
                <input type="text" id="reg_hours"  name="reg_hours" value = "<?php if(isset($reg_hours) && count($errors) == 0 ) { echo $reg_hours;} ?>"/> 
            </div>
        </div> 
        <div class="row">
            <div class="col">
                <label for="wage">Regular Hours Pay</label> 
                <input type="text" id="reg_pay"  name="reg_pay" value = "<?php if(isset($regular) && count($errors) == 0 ) { echo $regular; } ?>"/> 
            </div>
        </div>  
        <div class="row">
            <div class="col">
                <label for="gross">Gross Pay</label> 
                <input type="text" id="gross"  name="gross" value = "<?php if(isset($gross) && count($errors) == 0 ) { echo $gross;} ?>" /> 
            </div>
        </div>
        <div id="payroll" class="row">
            <div class="col">
                <label for="payroll">Payroll Tax</label> 
                <input type="text" id="payroll"  name="payroll" value = "<?php if(isset($payroll_tax) && count($errors) == 0 ) { echo $payroll_tax;} ?>" /> 
            </div>
        </div>
        <div id="net_pay" class="row">
            <div class="col">
                <label for="net_pay">Net Pay</label> 
                <input type="text" id="net_pay"  name="net_pay" value = "<?php if(isset($net_pay) && count($errors) == 0 ) { echo $net_pay;} ?>"/> 
            </div>
        </div>  
        <div class="row">
           <div class="col">
               <button type="submit" name="my_submit">Calculate</button>
           </div>
        </div>
       <!-- value = "<?php echo $fullName?>"-->
    </form>
       
</div>